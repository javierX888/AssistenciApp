<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/curso-lista-profesor"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ nombreCurso }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Sección de control de clase -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Control de Clase</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div *ngIf="!claseActiva" class="clase-inactiva">
        <p>No hay clase activa. Inicia la clase de hoy para que los alumnos puedan registrar su asistencia.</p>
        <ion-button expand="block" (click)="iniciarClase()">
          <ion-icon slot="start" name="play-circle-outline"></ion-icon>
          Iniciar Clase del Día
        </ion-button>
      </div>
      
      <div *ngIf="claseActiva" class="clase-activa">
        <div class="qr-container">
          <qrcode [qrdata]="qrData" [width]="200" [errorCorrectionLevel]="'M'"></qrcode>
          <p class="fecha-clase">Clase del {{ fechaClase }}</p>
        </div>
        <ion-button expand="block" color="danger" (click)="finalizarClase()">
          <ion-icon slot="start" name="stop-circle-outline"></ion-icon>
          Finalizar Clase
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Lista de alumnos con estadísticas -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Alumnos ({{ alumnos.length }})</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let alumno of alumnos" [ngClass]="getItemClass(alumno)">
          <ion-avatar slot="start">
            <ion-icon name="person-circle" [ngClass]="getAvatarClass(alumno)"></ion-icon>
          </ion-avatar>
          <ion-label>
            <h2>{{ alumno.nombre }}</h2>
            <p>ID: {{ alumno.id }}</p>
            <div class="asistencia-stats">
              <ion-badge [color]="getBadgeColor(alumno)">{{ calcularPorcentaje(alumno) }}%</ion-badge>
              <span class="stats-text">{{ contarPresentes(alumno) }}/{{ contarTotal(alumno) }} clases</span>
            </div>
          </ion-label>
          <div slot="end" class="status-container">
            <ion-chip [color]="alumno.status === 1 ? 'success' : 'danger'">
              <ion-icon [name]="alumno.status === 1 ? 'checkmark-circle' : 'close-circle'"></ion-icon>
              <ion-label>{{ alumno.status === 1 ? 'Presente' : 'Ausente' }}</ion-label>
            </ion-chip>
            <ion-button 
              *ngIf="alumno.status === 0 && claseActiva" 
              fill="clear" 
              size="small"
              (click)="justificarInasistencia(alumno)">
              <ion-icon slot="icon-only" name="document-text-outline"></ion-icon>
            </ion-button>
          </div>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

</ion-content>
